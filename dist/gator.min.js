!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Gator=e()}}(function(){var e,t,i;return function e(t,i,s){function r(o,u){if(!i[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(n)return n(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var f=i[o]={exports:{}};t[o][0].call(f.exports,function(e){var i=t[o][1][e];return r(i?i:e)},f,f.exports,e,t,i,s)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<s.length;o++)r(s[o]);return r}({1:[function(t,i,s){!function(t,i){if("function"==typeof e&&e.amd)e(["exports"],i);else if("undefined"!=typeof s)i(s);else{var r={exports:{}};i(r.exports),t.config=r.exports}}(this,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t=e.PREFIX="gt",i=e.PRIORITY_DEFAULT=30,s=e.ValidatorState={INIT:0,WAIT:1,SUCCESS:2,ERROR:4,HANDLER:5},r=e.Events={KEYUP:"keyup",CHANGE:"change"},n=e.FieldQuery={prefix:"^"+t,input:"input:not(:disabled):not([readonly]):not([type=hidden]):not([type=reset]):not([type=submit]):not([type=button])",select:",select[required]:not(:disabled):not([readonly])",textarea:",textarea[required]:not(:disabled):not([readonly])",form:'form[name="{{name}}"]',messages:"["+t+"-messages]",message:"["+t+"-message]"},o=e.Attributes={prefix:t+"-",messages:t+"-messages",message:t+"-message"},u=e.RuleTypes={email:/^[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9]([a-z0-9-]*[a-z0-9])?(\.[a-z0-9]([a-z0-9-]*[a-z0-9])?)*$/i,number:/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,integer:/^-?\d+$/,digits:/\d+$/,alphanum:/^\w+$/i,date:/^(\d{4})-(\d{2})-(\d{2})$/,url:/^(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?$/},a=e.Rules={required:{fn:function e(t){return/\S/.test(t)},priority:1024,handler:!1},type:{fn:function e(t){var i=u[this.params[0]];return i.test(t)},priority:256,handler:!1},minlength:{fn:function e(t){return t.length>=this.params[0]},priority:512,handler:!1},maxlength:{fn:function e(t){return t.length<=this.params[0]},priority:512,handler:!1},group:{fn:function e(t,i,s){for(var r in t)if(!t[r].value)return void s();i()},priority:0,handler:!0,required:!1},same:{fn:function e(t,i,s){var r=t[Object.keys(t)[0]];for(var n in t)if(t[n].value!==r.value)return void s();i()},priority:0,handler:!0,required:!0}}})},{}],2:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./config.js","./utils.js","./validator"],n);else if("undefined"!=typeof s)n(i,t("./config.js"),t("./utils.js"),t("./validator"));else{var o={exports:{}};n(o,r.config,r.utils,r.validator),r.formField=o.exports}}(this,function(e,t,i,s){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=r(s),u=function(){function e(t,s){n(this,e),this.uniqueId=(0,i.getUniqueId)(),this.formName=s,this._fieldElem=t,this.fieldName=t.getAttribute("name"),this._validators=[],this.validatorIndex=0,this.onInit()}return e.prototype.onInit=function e(){this.registerValidators(),this.prioritizeValidators(),this.subscribe(),this.listeners()},e.prototype.listeners=function e(){this._fieldElem.addEventListener(t.Events.KEYUP,this,!1),this._fieldElem.addEventListener(t.Events.CHANGE,this,!1)},e.prototype.handleEvent=function e(i){switch(i.type){case t.Events.CHANGE:this.validatorLoop(t.Events.CHANGE);break;case t.Events.KEYUP:this.validatorIndex=0,this.validatorLoop(t.Events.KEYUP)}},e.prototype.subscribe=function e(){this.subCBDisable=i.pubSub.subscribe("field:disable",this.callbackDisable.bind(this)),this.subCBSuccess=i.pubSub.subscribe("field:callbackSuccess",this.callbackSuccess.bind(this)),this.subCBError=i.pubSub.subscribe("field:callbackError",this.callbackError.bind(this)),this.subCBDestroy=i.pubSub.subscribe("field:destroy",this.destroy.bind(this))},e.prototype.callbackSuccess=function e(t){this.uniqueId===t.uniqueId&&(this.enable(),this.clearError())},e.prototype.callbackError=function e(i){this.uniqueId===i.uniqueId&&(this.enable(),this._validators[this.validatorIndex].state!==t.ValidatorState.ERROR&&this.showError(i.key))},e.prototype.callbackDisable=function e(t){this.uniqueId===t.uniqueId&&this.disable()},e.prototype.handler=function e(t,s){i.pubSub.publish("handler:execute",{uniqueId:this.uniqueId,fieldName:this.fieldName,fieldValue:s,key:t})},e.prototype.validatorLoop=function e(i){for(var s=this._fieldElem.value,r=null,n=this._validators,o=this.validatorIndex,u=this._validators.length;o<u;o++)if(r=n[o],i===r.event||r.event===t.Events.KEYUP){if(this.validatorIndex=o,this.clearError(),r.validate(s),r.isHandler())return void this.handler(r.key,s);if(r.isError())return void this.showError(r.key)}this.clearError()},e.prototype.showError=function e(t){i.pubSub.publish("messages:show",{fieldName:this.fieldName,formName:this.formName,key:t})},e.prototype.clearError=function e(){i.pubSub.publish("messages:clear",{fieldName:this.fieldName,formName:this.formName})},e.prototype.registerValidators=function e(){var s=this,r=this,n=null,u=new RegExp(t.FieldQuery.prefix,"i");(0,i.nl2arr)(this._fieldElem.attributes).forEach(function(e){n=e.name&&u.test(e.name)&&e.specified?e.name.slice(t.Attributes.prefix.length):"required"===e.name&&e.specified?"required":null,n&&r._validators.push(new o.default((0,i.convertCamelCase)(n),e.value,s.fieldName,s.uniqueId))})},e.prototype.prioritizeValidators=function e(){this._validators.length&&this._validators.sort(function(e,t){return t.priority-e.priority})},e.prototype.enable=function e(){this._fieldElem.disabled=!1},e.prototype.disable=function e(){this._fieldElem.disabled=!0},e.prototype.destroy=function e(){console.log("fields are destroyed!"),this._fieldElem.removeEventListener("keyup",this,!1),this._fieldElem.removeEventListener("change",this,!1),this._fieldElem=null,this._validators.length=0,this.subCBSuccess.remove(),this.subCBError.remove(),this.subCBDestroy.remove(),this.subCBDisable.remove()},e}();e.exports=u})},{"./config.js":1,"./utils.js":7,"./validator":8}],3:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./form-field","./messages","./utils.js","./config.js"],n);else if("undefined"!=typeof s)n(i,t("./form-field"),t("./messages"),t("./utils.js"),t("./config.js"));else{var o={exports:{}};n(o,r.formField,r.messages,r.utils,r.config),r.form=o.exports}}(this,function(e,t,i,s,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=n(t),a=n(i),l=function(){function e(t){o(this,e),this._elem=t,this._fields=[],this.name=null,this.onInit()}return e.prototype.onInit=function e(){this.name=this._elem.getAttribute("name"),this.registerFormFields(),this.subscribe()},e.prototype.subscribe=function e(){this.subCBDestroy=s.pubSub.subscribe("form:destroy",this.destroy.bind(this))},e.prototype.registerFormFields=function e(){var t=this;(0,s.nl2arr)(this._elem.querySelectorAll(r.FieldQuery.input+r.FieldQuery.select+r.FieldQuery.textarea)).forEach(function(e){t._fields.push(new u.default(e,t.name))})},e.prototype.destroy=function e(){console.log("form is destroyed"),this._elem=null,this._fields.length=0,this.subCBDestroy.remove()},e}();e.exports=l})},{"./config.js":1,"./form-field":2,"./messages":6,"./utils.js":7}],4:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./config","./utils.js","./form","./messages","./handler"],n);else if("undefined"!=typeof s)n(i,t("./config"),t("./utils.js"),t("./form"),t("./messages"),t("./handler"));else{var o={exports:{}};n(o,r.config,r.utils,r.form,r.messages,r.handler),r.gator=o.exports}}(this,function(e,t,i,s,r,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var f=o(s),d=o(r),h=o(n),c=function(){function e(t){l(this,e),this._messages=[],this._forms=[],this._handler=null}return e.prototype._init=function e(t){this._handler=new h.default,this._registerMessages(),this._registerForm(t)},e.prototype._registerForm=function e(s){var r=this,n=s?t.FieldQuery.form.replace(/\{\{name\}\}/,s):"form";(0,i.nl2arr)(document.querySelectorAll(n)).forEach(function(e){r._forms.push(new f.default(e))})},e.prototype._registerMessages=function e(){var s=this;(0,i.nl2arr)(document.querySelectorAll(t.FieldQuery.messages)).forEach(function(e){s._messages.push(new d.default(e))})},e.prototype._destroy=function e(){console.log("main is destroyed"),i.pubSub.publish("field:destroy",{}),i.pubSub.publish("messages:destroy",{}),i.pubSub.publish("handler:destroy",{}),i.pubSub.publish("form:destroy",{}),i.pubSub.publish("validator:destroy",{}),this._messages.length=0,this._forms.length=0,this._handler=null},e}(),p=function(e){function i(){return l(this,i),u(this,e.call(this))}return a(i,e),i.prototype.addRuleType=function e(i,s){if(!s instanceof RegExp)throw new Error(s+" must be a regular expression");if(t.RuleTypes.hasOwnProperty(i))throw new Error(i+" already exists as a rule type");if("string"!=typeof i)throw new Error(i+" must be a string.");return t.RuleTypes[i]=s,this},i.prototype.validator=function e(i,s,r,n){return t.Rules[i]={fn:s,priority:n||0,handler:!0,required:r||!1},this},i.prototype.destroy=function e(){return this._destroy(),this},i.prototype.init=function e(t){return this._init(t),this},i}(c);e.exports=p})},{"./config":1,"./form":3,"./handler":5,"./messages":6,"./utils.js":7}],5:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./utils","./form-field","./config.js"],n);else if("undefined"!=typeof s)n(i,t("./utils"),t("./form-field"),t("./config.js"));else{var o={exports:{}};n(o,r.utils,r.formField,r.config),r.handler=o.exports}}(this,function(e,t,i,s){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=r(i),u=function(){function e(t){n(this,e),this.uniqueId=t,this.value=null,this.ready=!1}return e.prototype.isType=function e(t){return s.Rules.type.fn.call({params:[t]},this.value)},e}(),a=function(){function e(){n(this,e),this._handlers={},this.onInit()}return e.prototype.onInit=function e(){this.subscribe()},e.prototype.subscribe=function e(){this.subRegister=t.pubSub.subscribe("handler:register",this.register.bind(this)),this.subAddField=t.pubSub.subscribe("handler:addField",this.addField.bind(this)),this.subExecute=t.pubSub.subscribe("handler:execute",this.execute.bind(this)),this.subDestroy=t.pubSub.subscribe("handler:destroy",this.destroy.bind(this))},e.prototype.register=function e(t){this._handlers.hasOwnProperty(t.key)||(this._handlers[t.key]={fields:{},key:t.key})},e.prototype.addField=function e(t){this.register(t),this._handlers[t.key].fields[t.fieldName]=new u(t.uniqueId)},e.prototype.setFieldReady=function e(t,i,s){var r=this._handlers[t].fields[i];r.value=s,r.ready=!0},e.prototype.checkFieldsReady=function e(t){var i=this._handlers[t].fields;for(var s in i)if(i.hasOwnProperty(s)&&!i[s].ready)return!1;return!0},e.prototype.disableFields=function e(i){var s=this._handlers[i].fields;for(var r in s)s.hasOwnProperty(r)&&t.pubSub.publish("field:disable",{uniqueId:s[r].uniqueId})},e.prototype.execute=function e(t){var i=!!s.Rules[t.key].hasOwnProperty("required")&&s.Rules[t.key].required;this.setFieldReady(t.key,t.fieldName,t.fieldValue),!this.checkFieldsReady(t.key)&&i||(this.disableFields(t.key),s.Rules[t.key].fn(this._handlers[t.key].fields,this.callback.bind(this._handlers[t.key],"field:callbackSuccess"),this.callback.bind(this._handlers[t.key],"field:callbackError"),this.callback.bind(this._handlers[t.key],"field:callbackIgnore")))},e.prototype.callback=function e(i){for(var s in this.fields)this.fields.hasOwnProperty(s)&&t.pubSub.publish(i,{uniqueId:this.fields[s].uniqueId,key:this.key})},e.prototype.destroy=function e(){console.log("handler is destroyed."),this._handlers=null,this.subRegister.remove(),this.subAddField.remove(),this.subExecute.remove(),this.subDestroy.remove()},e}();e.exports=a})},{"./config.js":1,"./form-field":2,"./utils":7}],6:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./utils.js","./config.js"],n);else if("undefined"!=typeof s)n(i,t("./utils.js"),t("./config.js"));else{var o={exports:{}};n(o,r.utils,r.config),r.messages=o.exports}}(this,function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(t){s(this,e),this._elem=t,this._messages={},this.formName=null,this.fieldName=null,this.onInit()}return e.prototype.onInit=function e(){var t=this._elem.getAttribute(i.Attributes.messages).split(".");this.formName=t[0],this.fieldName=t[1],this.registerBlockMessages(),this.subscribe(),this.clearMessages()},e.prototype.subscribe=function e(){this.subShow=t.pubSub.subscribe("messages:show",this.showMessage.bind(this)),this.subClear=t.pubSub.subscribe("messages:clear",this.clearMessages.bind(this)),this.subDestroy=t.pubSub.subscribe("messages:destroy",this.destroy.bind(this))},e.prototype.clearMessages=function e(t){var i=this._messages;if(void 0===t||t.fieldName===this.fieldName&&t.formName===this.formName)for(var s in i)this._messages.hasOwnProperty(s)&&(i[s].style.display="none")},e.prototype.showMessage=function e(t){t.fieldName===this.fieldName&&t.formName===this.formName&&(this.clearMessages(t),this._messages.hasOwnProperty(t.key)&&(this._messages[t.key].style.display="block"))},e.prototype.isKeyValid=function e(t){if(!this._messages.hasOwnProperty(t))throw new Error('Missing "gt-'+t+' in gt-messages="'+this.formName+"."+this.fieldName+'"')},e.prototype.registerBlockMessages=function e(){var s=this,r=null;(0,t.nl2arr)(this._elem.querySelectorAll(i.FieldQuery.message)).forEach(function(e){r=e.getAttribute(i.Attributes.message),r&&(s._messages[r]=e)})},e.prototype.destroy=function e(){console.log("messages are destroyed"),this._elem=null,this._messages=null,this.subShow.remove(),this.subClear.remove(),this.subDestroy.remove()},e}();e.exports=r})},{"./config.js":1,"./utils.js":7}],7:[function(t,i,s){!function(t,i){if("function"==typeof e&&e.amd)e(["exports"],i);else if("undefined"!=typeof s)i(s);else{var r={exports:{}};i(r.exports),t.utils=r.exports}}(this,function(e){"use strict";function t(e){return Array.prototype.slice.call(e)}function i(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function s(e){return e.replace(/-([a-z])/g,function(e){return e[1].toUpperCase()})}Object.defineProperty(e,"__esModule",{value:!0}),e.nl2arr=t,e.getUniqueId=i,e.convertCamelCase=s;var r=e.pubSub=function(){var e={},t=e.hasOwnProperty;return{subscribe:function i(s,r){t.call(e,s)||(e[s]=[]);var n=e[s].push(r)-1;return{remove:function t(){delete e[s][n]}}},publish:function i(s,r){t.call(e,s)&&e[s].forEach(function(e){e(void 0!=r?r:{})})}}}()})},{}],8:[function(t,i,s){!function(r,n){if("function"==typeof e&&e.amd)e(["module","./config","./utils"],n);else if("undefined"!=typeof s)n(i,t("./config"),t("./utils"));else{var o={exports:{}};n(o,r.config,r.utils),r.validator=o.exports}}(this,function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(i,r,n,o){s(this,e),this.key=i,this.fieldName=n,this.fieldUniqueId=o,this.state=t.ValidatorState.INIT;var u=r.match(/^(.*?)(?:\:(\w*)){0,1}$/);this.params=u[1]?u[1].split(","):null,this.event=u[2]||t.Events.KEYUP,this.onInit()}return e.prototype.onInit=function e(){this.setPriority(),this.setHandler(),this.subscribe()},e.prototype.subscribe=function e(){this.subCBDestroy=i.pubSub.subscribe("validator:destroy",this.destroy.bind(this))},e.prototype.setPriority=function e(){if(!t.Rules.hasOwnProperty(this.key))throw new Error('Invalid directive, "gt-'+this.key+'"');this.priority=t.Rules[this.key].priority},e.prototype.setHandler=function e(){var s=this;t.Rules[this.key].handler&&i.pubSub.publish("handler:addField",{key:s.key,fieldName:s.fieldName,uniqueId:s.fieldUniqueId})},e.prototype.validate=function e(i){var s=this,r=t.Rules[this.key];r.handler===!0?this.state=t.ValidatorState.HANDLER:this.state=r.fn.call(this,i)?t.ValidatorState.SUCCESS:t.ValidatorState.ERROR},e.prototype.isHandler=function e(){return this.state===t.ValidatorState.HANDLER},e.prototype.isError=function e(){return this.state===t.ValidatorState.ERROR},e.prototype.destroy=function e(){console.log("valdidator is destroyed!"), this.params.length=0,this.subCBDestroy.remove()},e}();e.exports=r})},{"./config":1,"./utils":7}]},{},[4])(4)});
